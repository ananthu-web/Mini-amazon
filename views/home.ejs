<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mini Amazon</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css.css">
</head>
<body class="bg-light">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-warning shadow fixed-top px-3 py-3">
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/">Mini Amazon</a>
    <form class="d-flex w-50">
      <input class="form-control me-2" type="search" placeholder="Search products...">
      <button class="btn btn-dark" type="submit">Search</button>
    </form>
    <div>
      <a href="/cart" class="btn btn-outline-dark me-2">ðŸ›’ Cart</a>
      <% if (!user) { %>
        <a href="/register" class="btn btn-outline-dark">Sign up</a>
        <a href="/login" class="btn btn-outline-dark">Login</a>
      <% } else { %>
        <span class="me-2">Hello, <%= user.email %></span>
        <a href="/logout" class="btn btn-outline-dark">Logout</a>
      <% } %>
    </div>
  </div>
</nav>

<!-- Product Grid -->
<div class="container my-5 pt-5">
  <div class="row g-4">

    <% const products = [
      {name: 'iPhone 15', price: 1200, img: 'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.gizmochina.com%2Fwp-content%2Fuploads%2F2023%2F10%2FiPhone-15-1024x651.png&f=1&nofb=1&ipt=0d290b33ea1679d0245632fa13c07d296b2dc54fa04aa60d7229958c767ed7cb', desc:'Latest Apple iPhone'},
      {name: 'MacBook Air', price: 1500, img:'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.apple.com%2Fnewsroom%2Fimages%2F2025%2F03%2Fapple-introduces-the-new-macbook-air-with-the-m4-chip-and-a-sky-blue-color%2Farticle%2FApple-MacBook-Air-hero-250305_big.jpg.large_2x.jpg&f=1&nofb=1&ipt=aa943d7cdea5527fe4444b37f3adab8e68a4c69945212f54941a189c40de707a', desc:'Lightweight Apple laptop'},
      {name: 'AirPods Pro', price: 250, img:'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fm.media-amazon.com%2Fimages%2FI%2F71zny7BTRlL._AC_SL1500_.jpg&f=1&nofb=1&ipt=6284afbd5db1fa68714171c6ec2e430a19f8102d839231937792e9eb288f14c7', desc:'Noise-cancelling wireless earbuds'},
      {name: 'Samsung Galaxy S23', price: 1100, img:'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%2Fid%2FOIP.5QMkXIlusvZfEUm50okfbAHaHa%3Fpid%3DApi&f=1&ipt=3dc313bc07b6db74a883edca103eefdb9e9309fb2714fa1834c5472089392f14', desc:'Flagship Android smartphone'},
      {name: 'Sony WH-1000XM5', price: 400, img:'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fd1ncau8tqf99kp.cloudfront.net%2Fconverted%2F103364_original_local_1200x1050_v3_converted.webp&f=1&nofb=1&ipt=e8d679b7408dbb56f3eb8a3b75cb71dc11fad1143aa139beede5ec0e22adf947', desc:'Premium noise-cancelling headphones'},
      {name: 'Apple Watch Series 9', price: 500, img:'https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fi.ytimg.com%2Fvi%2FuJ235iTBkh0%2Fmaxresdefault.jpg&f=1&nofb=1&ipt=40f7bf5d622f37ec741ce7b533f1082df9d278d1db7a43414695c4714d5f89e6', desc:'Advanced fitness & health tracking'}
    ]; %>

    <% products.forEach(product => { %>
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <img src="<%= product.img %>" class="card-img-top" alt="<%= product.name %>" style="height:260px;">
          <div class="card-body text-center">
            <h5 class="card-title"><%= product.name %></h5>
            <p class="card-text"><%= product.desc %></p>
            <p class="fw-bold text-success">$<%= product.price %></p>
            
            <% if (user) { %>
              <button class="btn btn-warning w-100 add-to-cart-btn"
                data-name="<%= product.name %>"
                data-price="<%= product.price %>">
                Add to Cart
              </button>
            <% } else { %>
              <a href="/login" class="btn btn-warning w-100">Login to Add</a>
            <% } %>

          </div>
        </div>
      </div>
    <% }) %>

  </div>
</div>

<!-- AJAX Script -->
<script>
  document.querySelectorAll('.add-to-cart-btn').forEach(button => {
    button.addEventListener('click', () => {
      const name = button.dataset.name;
      const price = button.dataset.price;

      fetch('/add-to-cart', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: `name=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}`
      })
      .then(res => {
        if(res.ok){
          alert(`${name} added to cart!`);
        } else {
          alert('Failed to add item. Login first.');
        }
      });
    });
  });
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
