<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mini Amazon</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body class="bg-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-warning shadow fixed-top px-3 py-0">
    <div class="container-fluid d-flex align-items-center justify-content-between flex-nowrap">

      <!-- Brand / Logo -->
      <a class="navbar-brand fw-bold d-flex align-items-center" href="/">
        <img src="/images/Logo.png" alt="Mini Azaxon Logo"
          style="height:60px; width:auto; object-fit:contain; margin-right:8px; margin-left: 15px; transform: scale(1.6);">
      </a>

      <!-- Search form (always visible) -->
      <form class="d-flex mx-2 mx-lg-5 flex-grow-1" action="/" method="GET">
        <input class="form-control rounded-pill ps-3 w-100 search-input" type="search" name="search"
          placeholder="Search products..." onkeydown="if(event.key==='Enter'){this.form.submit();}">
      </form>

      <!-- Hamburger button (mobile only) -->
      <button class="btn btn-warning d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu"
        aria-controls="mobileMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Desktop buttons and three-dots menu -->
      <div class="ms-auto d-none d-lg-flex align-items-center">
      
        <% if (!user) { %>
            <a href="/cart" class="btn btn-custom me-3 mb-2 mb-lg-0 rounded-pill">ðŸ›’ Cart</a>
          <a href="/user/register" class="btn btn-custom me-3 mb-2 mb-lg-0 rounded-pill">Sign Up</a>
          <a href="/user/login" class="btn btn-custom me-3 mb-2 mb-lg-0 rounded-pill">Login</a>

          <!-- Desktop three-dots menu -->
          <div class="dropdown">
            <button class="btn btn-custom rounded-pill dropdown-toggle" type="button" id="moreMenu"
              data-bs-toggle="dropdown" aria-expanded="false">
              &#x22EE;
            </button>
            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-square" aria-labelledby="moreMenu">
              <li><a class="dropdown-item" href="#">Profile</a></li>
              <li><a class="dropdown-item" href="#">Orders</a></li>
              <li>
                <hr class="dropdown-divider">
              </li>
              <li><a class="dropdown-item" href="#">Help</a></li>
              <li><a class="dropdown-item" href="#">Settings</a></li>


            </ul>
          </div>

          <% } else { %>
            
            <span class="me-3 " style="font-weight: bolder;">Hello, <%= user.username %></span>
               <a href="/cart" class="btn btn-custom me-3 mb-2 mb-lg-0 rounded-pill">ðŸ›’ Cart</a>
            <a href="/logout" class="btn btn-custom me-3 mb-2 mb-lg-0 rounded-pill">Logout</a>

            <!-- Desktop three-dots menu -->
            <div class="dropdown">
              <button class="btn btn-custom rounded-pill dropdown-toggle" type="button" id="moreMenu"
                data-bs-toggle="dropdown" aria-expanded="false">
                &#x22EE;
              </button>
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-square" aria-labelledby="moreMenu">
                <li><a class="dropdown-item" href="#">Profile</a></li>
                <li><a class="dropdown-item" href="#">Orders</a></li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" href="#">Help</a></li>
                <li><a class="dropdown-item" href="#">Settings</a></li>
              </ul>
            </div>
            <% } %>
      </div>

      <!-- Mobile offcanvas menu -->
      <div class="offcanvas offcanvas-end rounded-offcanvas w-50 d-lg-none" tabindex="-1" id="mobileMenu"
        aria-labelledby="mobileMenuLabel">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="mobileMenuLabel">Menu</h5>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
         
          <% if (!user) { %>
             <a href="/cart" class="btn btn-custom mb-2 rounded-pill">ðŸ›’ Cart</a>
            <a href="/user/register" class="btn btn-custom mb-2 rounded-pill">Sign Up</a>
            <a href="/user/login" class="btn btn-custom mb-2 rounded-pill">Login</a>
            <a href="#" class="btn btn-custom mb-2 rounded-pill">Profile</a>
            <a href="#" class="btn btn-custom mb-2 rounded-pill">Orders</a>
            <a href="#" class="btn btn-custom mb-2 rounded-pill">Help</a>
            <a href="#" class="btn btn-custom mb-2 rounded-pill">Settings</a>
            <% } else { %>
                
              <span class="mb-2">Hello, <%= user.username %></span>
               <a href="/cart" class="btn btn-custom mb-2 rounded-pill">ðŸ›’ Cart</a>
              <a href="/logout" class="btn btn-custom mb-2 rounded-pill">Logout</a>
              <a href="#" class="btn btn-custom mb-2 rounded-pill">Profile</a>
              <a href="#" class="btn btn-custom mb-2 rounded-pill">Orders</a>
              <a href="#" class="btn btn-custom mb-2 rounded-pill">Help</a>
              <a href="#" class="btn btn-custom mb-2 rounded-pill">Settings</a>
              <% } %>
        </div>
      </div>

    </div> <!-- end container-fluid -->
  </nav>

  <!-- Product Grid -->
  <div class="container product-container my-5 pt-4">
    <div class="row g-4">
      <% products.forEach(product=> { %>
        <div class="col-sm-6 col-md-4 col-lg-3">
          <div class="card shadow h-100">
            <img src="<%= product.img %>" class="card-img-top" alt="<%= product.name %>"
              style="height:260px; object-fit:contain;">
            <div class="card-body text-center d-flex flex-column">
              <h5 class="card-title">
                <%= product.name %>
              </h5>
              <p class="card-text">
                <%= product.desc %>
              </p>
              <p class="fw-bold text-success">$<%= product.price %>
              </p>

              <% if (user) { %>
                <button class="btn btn-warning w-100 mt-auto add-to-cart-btn" data-name="<%= product.name %>"
                  data-price="<%= product.price %>">
                  Add to Cart
                </button>
                <% } else { %>
                  <a href="/user/login" class="btn btn-warning w-100 mt-auto">Login to Add</a>
                  <% } %>
            </div>
          </div>
        </div>
        <% }) %>
    </div>
  </div>

  <!-- Add to Cart Script -->
  <script>

    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
      button.addEventListener('click', () => {
        const name = button.dataset.name;
        const price = button.dataset.price;

        fetch('/add-to-cart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `name=${encodeURIComponent(name)}&price=${encodeURIComponent(price)}`
        })
          .then(res => {
            if (res.ok) alert(`${name} added to cart!`);
            else alert('Failed to add item. Login first.');
          });
      });
    });



  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>